Vagrant.configure("2") do |config|
  
  # Vagrantbox = 'centos'
  Vagrantbox = 'deb'
  if "#{Vagrantbox}" == 'centos'
    VagrantBoxImage = 'centos/7'
  else
    # VagrantBoxImage = 'peru/ubuntu-20.04-server-amd64'
    VagrantBoxImage = 'generic/ubuntu2004'
  end

  config.vm.provision "shell"  do |script|
    script.path = "Common.sh"
    script.args = "#{Vagrantbox}"
  end
  config.vm.define "LoadBalancer" do |lb|
    lb.vm.provider "virtualbox" do |lb|
      lb.memory = 1024
      lb.cpus = 1
      lb.name = "LB-HA-Proxy"
      lb.gui = false
    end
    lb.vm.network "public_network", type: dhcp ,  bridge: "New Virtual Switch"
    lb.vm.box = "#{VagrantBoxImage}"
    lb.vm.hostname = "LB-HA-Proxy"
    # lb.vm.provision "shell", path: "provision_lb.sh"
  end

  (1..3).each do |i|
    config.vm.define "kubemaster#{i}" do |kubemaster|
      kubemaster.vm.provider "virtualbox" do |kubemaster|
        kubemaster.memory = 2048
        kubemaster.cpus = 2
        kubemaster.name = "kubemaster#{i}"
        kubemaster.gui = false
      end
      kubemaster.vm.network "public_network", bridge: "New Virtual Switch"
      kubemaster.vm.box = "#{VagrantBoxImage}"
      kubemaster.vm.hostname = "kubemaster#{i}"
      # kubemaster.vm.provision "shell", path: "provision_master.sh"
    end
  end
  (1..1).each do |i|
    config.vm.define "worker#{i}" do |worker|
      worker.vm.provider "virtualbox" do |worker|
        worker.name = "kubeworker#{i}"
        worker.memory = "1024"
        worker.cpus = "1"
        worker.gui = false
      end
      worker.vm.box = "#{VagrantBoxImage}"
      worker.vm.hostname = "kubeworker#{i}"
      worker.vm.network "public_network", bridge: "New Virtual Switch"
      # worker.vm.provision "shell", path: "provision_worker.sh"
    end
  end
end